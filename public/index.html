<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Servilimpia Morelia</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <div class="menu-icon">â˜°</div>
      <img src="recycling_logo.webp" alt="Logo" class="logo"  />
      <h1>Servilimpia Morelia</h1>  
      <button onclick="location.reload()">ðŸ”„</button>
    </header>

    <div class="form-section">
      <div class="input-group">
        <label for="num">Num:</label>
        <input type="text" id="num" inputmode="numeric" />
      </div>

      <div class="input-group">
        <label for="chofer">Chofer:</label>
        <input type="text" id="chofer" />
      </div>

      <div class="input-group">
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" />
      </div>
    </div>

    <!-- âœ… Tabla ahora con contenedor para scroll -->
    <div id="contenedorTabla">
      <table id="tablaMateriales">
        <thead>
          <tr>
            <th>Materiales</th>
            <th>$</th>
            <th>Kilo</th>
            <th>T-KILO</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>PET</td>
            <td><input type="text" class="price" inputmode="decimal"  data-material="pet"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>VIDRIO</td>
            <td><input type="text" class="price" inputmode="decimal"  data-material="vidrio"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>PAPEL</td>
            <td><input type="text" class="price" inputmode="decimal" data-material="papel"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>CHATARRA</td>
            <td><input type="text" class="price" inputmode="decimal" data-material="chatarra"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>CARTON</td>
            <td><input type="text" class="price" inputmode="decimal" data-material="carton"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>HDP</td>
            <td><input type="text" class="price" inputmode="decimal"  data-material="hdp"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr>
            <td>POLIESTIRENO</td>
            <td><input type="text" class="price" inputmode="decimal"  data-material="poliestireno"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
           <tr>
            <td>ALUMINIO</td>
            <td><input type="text" class="price" inputmode="decimal"  data-material="aluminio"/></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr id="fila-varios">
            <td><input type="text" class="descrption" placeholder="Varios" /></td>
            <td><input type="text" class="price" inputmode="decimal" /></td>
            <td><input type="text" class="kilograms" inputmode="decimal" /></td>
            <td><input type="text" class="total-price" inputmode="decimal" /></td>
          </tr>
          <tr id="fila-boton">
            <td colspan="4" style="text-align: center;">
              <button id="btnAgregarFila">âž• Agregar fila</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- âœ… Fin del contenedor con scroll -->

    <div class="total-section">
      <label>SubTotal: </label>
      <input type="text" id="subtotal" readonly />
    </div>

    <div class="total-section">
      <label>Descuento:</label>
      <input type="text" id="descuento" inputmode="decimal" />
    </div>

    <div class="total-section">
      <label>Total$</label>
      <input type="text" id="totalCompra" readonly />
    </div>
    
    <div class="buttons-section">
      <button id="toggleEditPrices">Guardar precios</button>
      <button id="btnPrintRawbt">Imprimir con RAWBT</button>
    </div>
  </div>

  <script>
  // âœ… CÃ³digo para generar texto plano e imprimir con RAWBT
  function imprimirConRawbt() {
    const num = document.getElementById("num").value;
    const chofer = document.getElementById("chofer").value;
    const fecha = document.getElementById("fecha").value;
    const total = document.getElementById("totalCompra").value;
    const subtotal = document.getElementById("subtotal").value;
    const descuento = document.getElementById("descuento").value;

    let contenido = "";
    contenido += "â™» SERVILIMPIA MORELIA SECTOR 7 â™»\n";
    contenido += `No: ${num}\nChofer: ${chofer}\nFecha: ${fecha}\n\n`;
    contenido += "Material    $   K  T-K\n";
    contenido += "â™»------------------------â™»\n";

    const filas = document.querySelectorAll("tbody tr");
    filas.forEach(fila => {
      const mat = fila.querySelector("td:first-child input")?.value || fila.querySelector("td:first-child")?.innerText;
      const precio = fila.querySelector(".price").value || "0";
      const kilos = fila.querySelector(".kilograms").value || "0";
      const totalFila = fila.querySelector(".total-price").value || "0";

      if (parseFloat(kilos) > 0 && parseFloat(totalFila) > 0) {
        const m = mat.padEnd(10, ' ').slice(0, 10);
        const p = precio.padStart(4, ' ').slice(0, 4);
        const k = kilos.padStart(3, ' ').slice(0, 3);
        const t = totalFila.padStart(5, ' ').slice(0, 5);
        contenido += `${m}${p}${k} ${t}\n`;
      }
    });

    contenido += "â™»------------------------â™»\n";
    contenido += `SUBTOTAL: $${subtotal}\n`;
    contenido += `DESC:     $${descuento}\n`;
    contenido += `TOTAL:    $${total}\n`;
    contenido += "QUE TENGAS BUEN DIA";

    const encoded = encodeURIComponent(contenido);
    window.location.href = `rawbt:${encoded}`;
  }

  // âœ… Enlazar el botÃ³n
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btnPrintRawbt");
    if (btn) btn.addEventListener("click", imprimirConRawbt);
  });

  function refrescarSoloPrecios() {
    const preciosGuardados = JSON.parse(localStorage.getItem("preciosMateriales") || "{}");
    const filas = document.querySelectorAll("#tablaMateriales tbody tr");

    filas.forEach(fila => {
      const celdaNombre = fila.querySelector("td:nth-child(1)");
      const inputPrecio = fila.querySelector("input[type='number']");
      const inputCantidad = fila.querySelector("td:nth-child(3) input");
      const celdaTotal = fila.querySelector("td:nth-child(4)");

      if (inputCantidad) inputCantidad.value = "";
      if (celdaTotal) celdaTotal.textContent = "$0.00";

      if (celdaNombre && inputPrecio) {
        const nombre = celdaNombre.textContent.trim();
        if (preciosGuardados[nombre] !== undefined) {
          inputPrecio.value = preciosGuardados[nombre];
        } else {
          inputPrecio.value = "";
        }
      }
    });

    // Limpiar campos de totales y descuento
    document.getElementById("subtotal").textContent = "$0.00";
    document.getElementById("totalCompra").textContent = "$0.00";
    const inputDescuento = document.getElementById("descuento");
    if (inputDescuento) inputDescuento.value = "";
  }
  </script>

  <script src="scriptC.js"></script>
</body>
</html>
